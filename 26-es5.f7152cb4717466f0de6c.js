function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[26],{upr6:function(e,t,r){"use strict";r.r(t),r.d(t,"CheckoutdetailPageModule",(function(){return le}));var n=r("ofXK"),a=r("3Pt+"),i=r("tyNb"),o=r("TEn/"),s=r("mrSG"),c=r("2Vo4"),l=r("z6cu"),b=r("IzEk"),d=r("un/a"),g=r("JIr8"),u=r("tk/3"),p=r("OJQs"),y=r("fXoL"),m=r("gren"),h=r("0IaG"),f=r("xHqg"),v=r("bTqV"),k=r("QibW"),D=r("kmnG"),V=r("qFsG"),W=r("B9HH"),S=r("6xI8"),x=r("sYmb"),C=["paypalcontainer"];function M(e,t){if(1&e&&(y.Wb(0,"div",24),y.Rb(1,"app-callphone",25),y.Vb()),2&e){var r=y.ic(3);y.Db(1),y.rc("mobile",r.ygen.getSettings().oncallsupport)}}function I(e,t){if(1&e){var r=y.Xb();y.Wb(0,"button",26),y.ec("click",(function(){y.Cc(r);var e=y.ic(3);return e.ygen.inviteviawhatsapp(e.ygen.getSettings().oncallwhatsappsupport,"Hi")})),y.Rb(1,"ion-icon",27),y.Vb()}}function w(e,t){if(1&e&&(y.Wb(0,"div",19),y.Wb(1,"h3"),y.Mc(2),y.jc(3,"translate"),y.Vb(),y.Wb(4,"p"),y.Mc(5),y.Vb(),y.Wb(6,"div",20),y.Wb(7,"div",21),y.Kc(8,M,2,1,"div",22),y.Kc(9,I,2,0,"button",23),y.Vb(),y.Vb(),y.Vb()),2&e){var r=y.ic(2);y.Db(2),y.Nc(y.kc(3,4,"Store's Instructions")),y.Db(3),y.Nc(r.ygen.getSettings().checkoutordermsg),y.Db(3),y.rc("ngIf",r.ygen.getSettings().oncallsupport&&(""+r.ygen.getSettings().oncallsupport).length>1),y.Db(1),y.rc("ngIf",r.ygen.getSettings().oncallwhatsappsupport&&(""+r.ygen.getSettings().oncallwhatsappsupport).length>1)}}function N(e,t){if(1&e&&(y.Wb(0,"div",28),y.Rb(1,"ion-icon",29),y.Wb(2,"h3"),y.Mc(3),y.jc(4,"translate"),y.Vb(),y.Wb(5,"p"),y.Mc(6),y.Vb(),y.Rb(7,"app-callphone",25),y.Wb(8,"ion-button",30),y.Mc(9),y.jc(10,"translate"),y.Vb(),y.Vb()),2&e){var r=y.ic(2);y.Db(3),y.Nc(y.kc(4,4,"No more Orders or Shop Subscription Expired")),y.Db(3),y.Nc(r.ygen.getSettings().stopordersmessage),y.Db(1),y.rc("mobile",r.ygen.getSettings().oncallsupport),y.Db(2),y.Oc("",y.kc(10,6,"Come back again")," ")}}function O(e,t){1&e&&(y.Mc(0),y.jc(1,"translate")),2&e&&y.Nc(y.kc(1,1,"Pick your Delivery option"))}function P(e,t){1&e&&(y.Wb(0,"div"),y.Wb(1,"h1"),y.Mc(2),y.jc(3,"translate"),y.Vb(),y.Vb()),2&e&&(y.Db(2),y.Nc(y.kc(3,1,"No Delivery Options Setup by Store; You can not proceed further")))}function j(e,t){1&e&&(y.Wb(0,"mat-radio-button",33),y.Mc(1),y.jc(2,"translate"),y.Vb()),2&e&&(y.Db(1),y.Oc(" ",y.kc(2,1,"Home Delivery"),""))}function T(e,t){1&e&&(y.Wb(0,"mat-radio-button",34),y.Mc(1),y.jc(2,"translate"),y.Vb()),2&e&&(y.Db(1),y.Oc(" ",y.kc(2,1,"Store Pickup"),""))}function F(e,t){if(1&e&&(y.Wb(0,"mat-radio-group",13),y.Kc(1,j,3,3,"mat-radio-button",31),y.Kc(2,T,3,3,"mat-radio-button",32),y.Vb()),2&e){var r=y.ic(2);y.rc("formControl",r.deliveryType),y.Db(1),y.rc("ngIf",r.ygen.getSettings().onlyhomepickup),y.Db(1),y.rc("ngIf",r.ygen.getSettings().onlystorepickup)}}function q(e,t){1&e&&(y.Mc(0),y.jc(1,"translate")),2&e&&y.Nc(y.kc(1,1,"Pick your Payment option"))}function K(e,t){1&e&&(y.Wb(0,"mat-radio-button",35),y.Mc(1),y.jc(2,"translate"),y.Vb()),2&e&&(y.Db(1),y.Oc(" ",y.kc(2,1,"Cash on Delivery"),""))}function L(e,t){1&e&&(y.Wb(0,"mat-radio-button",36),y.Mc(1),y.jc(2,"translate"),y.Vb()),2&e&&(y.Db(1),y.Oc(" ",y.kc(2,1,"Pay Now")," "))}function A(e,t){1&e&&(y.Mc(0),y.jc(1,"translate")),2&e&&y.Nc(y.kc(1,1,"Address Details"))}function E(e,t){1&e&&(y.Wb(0,"legend"),y.Mc(1),y.jc(2,"translate"),y.Vb()),2&e&&(y.Db(1),y.Nc(y.kc(2,1,"Your Details")))}function R(e,t){1&e&&(y.Wb(0,"legend"),y.Mc(1),y.jc(2,"translate"),y.Vb()),2&e&&(y.Db(1),y.Nc(y.kc(2,1,"Delivery Address")))}function _(e,t){if(1&e&&(y.Wb(0,"mat-error"),y.Mc(1),y.Vb()),2&e){var r=y.ic(3);y.Db(1),y.Oc(" ",r.getErrorMessage(r.addressForm.controls.userName,"Name"),"")}}function z(e,t){if(1&e&&(y.Wb(0,"mat-error"),y.Mc(1),y.Vb()),2&e){var r=y.ic(3);y.Db(1),y.Oc(" ",r.getErrorMessage(r.addressForm.controls.mobile,"mobile"),"")}}function Q(e,t){if(1&e&&(y.Wb(0,"mat-error"),y.Mc(1),y.Vb()),2&e){var r=y.ic(3);y.Db(1),y.Oc(" ",r.getErrorMessage(r.addressForm.controls.unitName,"Building Name"),"")}}function H(e,t){if(1&e&&(y.Wb(0,"mat-error"),y.Mc(1),y.Vb()),2&e){var r=y.ic(3);y.Db(1),y.Oc(" ",r.getErrorMessage(r.addressForm.controls.address,"Address"),"")}}function B(e,t){if(1&e&&(y.Wb(0,"mat-error"),y.Mc(1),y.Vb()),2&e){var r=y.ic(3);y.Db(1),y.Oc(" ",r.getErrorMessage(r.addressForm.controls.city,"City"),"")}}function U(e,t){if(1&e&&(y.Wb(0,"mat-error"),y.Mc(1),y.Vb()),2&e){var r=y.ic(3);y.Db(1),y.Oc(" ",r.getErrorMessage(r.addressForm.controls.state,"State"),"")}}function Y(e,t){if(1&e&&(y.Wb(0,"mat-error"),y.Mc(1),y.Vb()),2&e){var r=y.ic(3);y.Db(1),y.Oc(" ",r.getErrorMessage(r.addressForm.controls.zip,"Postal Code"),"")}}function G(e,t){if(1&e&&(y.Wb(0,"mat-error"),y.Mc(1),y.Vb()),2&e){var r=y.ic(3);y.Db(1),y.Oc(" ",r.getErrorMessage(r.addressForm.controls.country,"Country"),"")}}var X=function(){return["in"]};function J(e,t){if(1&e){var r=y.Xb();y.Wb(0,"div"),y.Wb(1,"form",37),y.Wb(2,"fieldset"),y.Kc(3,E,3,3,"legend",4),y.Kc(4,R,3,3,"legend",4),y.Wb(5,"table",38),y.Wb(6,"tr"),y.Wb(7,"td"),y.Wb(8,"mat-form-field",17),y.Wb(9,"mat-label"),y.Mc(10),y.jc(11,"translate"),y.Vb(),y.Rb(12,"input",39),y.Kc(13,_,2,1,"mat-error",4),y.Vb(),y.Vb(),y.Vb(),y.Wb(14,"tr"),y.Wb(15,"td"),y.Wb(16,"mat-form-field",17),y.Rb(17,"ngx-mat-intl-tel-input",40),y.jc(18,"translate"),y.Wb(19,"mat-hint"),y.Mc(20),y.jc(21,"translate"),y.Vb(),y.Kc(22,z,2,1,"mat-error",4),y.Vb(),y.Vb(),y.Vb(),y.Wb(23,"tr"),y.Wb(24,"td"),y.Wb(25,"mat-form-field",17),y.Wb(26,"mat-label"),y.Mc(27),y.jc(28,"translate"),y.Vb(),y.Rb(29,"input",41),y.Kc(30,Q,2,1,"mat-error",4),y.Vb(),y.Vb(),y.Vb(),y.Vb(),y.Wb(31,"p"),y.Wb(32,"mat-form-field",17),y.Wb(33,"mat-label"),y.Mc(34),y.jc(35,"translate"),y.Vb(),y.Wb(36,"textarea",42),y.Mc(37,"\n                  "),y.Vb(),y.Kc(38,H,2,1,"mat-error",4),y.Vb(),y.Vb(),y.Wb(39,"table",38),y.Wb(40,"tr"),y.Wb(41,"td"),y.Wb(42,"mat-form-field",17),y.Wb(43,"mat-label"),y.Mc(44),y.jc(45,"translate"),y.Vb(),y.Rb(46,"input",43),y.Kc(47,B,2,1,"mat-error",4),y.Vb(),y.Vb(),y.Vb(),y.Wb(48,"tr"),y.Wb(49,"td"),y.Wb(50,"mat-form-field",17),y.Wb(51,"mat-label"),y.Mc(52),y.jc(53,"translate"),y.Vb(),y.Rb(54,"input",44),y.Kc(55,U,2,1,"mat-error",4),y.Vb(),y.Vb(),y.Vb(),y.Wb(56,"tr"),y.Wb(57,"td"),y.Wb(58,"mat-form-field",17),y.Wb(59,"mat-label"),y.Mc(60),y.jc(61,"translate"),y.Vb(),y.Rb(62,"input",45,46),y.Wb(64,"mat-hint",47),y.Mc(65),y.Vb(),y.Kc(66,Y,2,1,"mat-error",4),y.Vb(),y.Vb(),y.Vb(),y.Wb(67,"tr"),y.Wb(68,"td"),y.Wb(69,"mat-form-field",48),y.Rb(70,"input",49,50),y.Vb(),y.Wb(72,"mat-select-country",51),y.ec("onCountrySelected",(function(e){y.Cc(r);var t=y.ic(2);return t.onCountrySelected(e,t.addressForm.controls.country)})),y.Vb(),y.Kc(73,G,2,1,"mat-error",4),y.Vb(),y.Vb(),y.Vb(),y.Vb(),y.Vb(),y.Vb()}if(2&e){var n=y.zc(63),a=y.zc(71),i=y.ic(2);y.Db(1),y.rc("formGroup",i.addressForm),y.Db(2),y.rc("ngIf",i.isrequiredAddressForm()),y.Db(1),y.rc("ngIf",!i.isrequiredAddressForm()),y.Db(6),y.Nc(y.kc(11,27,"Name")),y.Db(3),y.rc("ngIf",i.addressForm.controls.userName.invalid),y.Db(4),y.sc("placeholder",y.kc(18,29,"mobile")),y.rc("cssClass","custom")("preferredCountries",y.uc(43,X))("enablePlaceholder",!0)("enableSearch",!0)("formControl",i.addressForm.controls.mobile)("required",!0),y.Db(3),y.Nc(y.kc(21,31,"Your Mobile..")),y.Db(2),y.rc("ngIf",i.addressForm.controls.mobile.invalid),y.Db(5),y.Nc(y.kc(28,33,"Building Name")),y.Db(3),y.rc("ngIf",i.addressForm.controls.unitName.invalid),y.Db(4),y.Nc(y.kc(35,35,"Address")),y.Db(4),y.rc("ngIf",i.addressForm.controls.address.invalid),y.Db(6),y.Nc(y.kc(45,37,"City")),y.Db(3),y.rc("ngIf",i.addressForm.controls.city.invalid),y.Db(5),y.Nc(y.kc(53,39,"State")),y.Db(3),y.rc("ngIf",i.addressForm.controls.state.invalid),y.Db(5),y.Nc(y.kc(61,41,"Postal Code")),y.Db(5),y.Oc("",n.value.length,"/5"),y.Db(1),y.rc("ngIf",i.addressForm.controls.zip.invalid),y.Db(6),y.rc("country",a.value),y.Db(1),y.rc("ngIf",i.addressForm.controls.country.invalid)}}function $(e,t){1&e&&(y.Wb(0,"div",28),y.Rb(1,"ion-icon",29),y.Wb(2,"h3"),y.Mc(3),y.jc(4,"translate"),y.Vb(),y.Wb(5,"p"),y.Mc(6),y.jc(7,"translate"),y.Vb(),y.Wb(8,"ion-button",30),y.Mc(9),y.jc(10,"translate"),y.Vb(),y.Vb()),2&e&&(y.Db(3),y.Nc(y.kc(4,3,"Your Cart is Empty")),y.Db(3),y.Nc(y.kc(7,5,"Lets get you started")),y.Db(3),y.Oc("",y.kc(10,7,"Start shopping")," "))}function Z(e,t){if(1&e&&(y.Wb(0,"ion-content",5),y.Kc(1,w,10,6,"div",6),y.Kc(2,N,11,8,"div",7),y.Wb(3,"mat-vertical-stepper",8,9),y.Wb(5,"mat-step"),y.Kc(6,O,2,3,"ng-template",10),y.Wb(7,"div"),y.Wb(8,"div"),y.Wb(9,"div"),y.Kc(10,P,4,3,"div",4),y.Kc(11,F,3,3,"mat-radio-group",11),y.Vb(),y.Vb(),y.Vb(),y.Wb(12,"div"),y.Wb(13,"button",12),y.Mc(14),y.jc(15,"translate"),y.Vb(),y.Vb(),y.Vb(),y.Wb(16,"mat-step"),y.Kc(17,q,2,3,"ng-template",10),y.Wb(18,"div"),y.Wb(19,"div"),y.Wb(20,"div"),y.Wb(21,"mat-radio-group",13),y.Kc(22,K,3,3,"mat-radio-button",14),y.Kc(23,L,3,3,"mat-radio-button",15),y.Vb(),y.Vb(),y.Vb(),y.Vb(),y.Wb(24,"div"),y.Wb(25,"button",12),y.Mc(26),y.jc(27,"translate"),y.Vb(),y.Vb(),y.Vb(),y.Wb(28,"mat-step"),y.Kc(29,A,2,3,"ng-template",10),y.Wb(30,"div"),y.Wb(31,"form",16),y.Wb(32,"fieldset"),y.Wb(33,"legend"),y.Mc(34),y.jc(35,"translate"),y.Vb(),y.Wb(36,"mat-form-field",17),y.Wb(37,"mat-label"),y.Mc(38),y.jc(39,"translate"),y.Vb(),y.Rb(40,"textarea",18),y.Vb(),y.Vb(),y.Vb(),y.Kc(41,J,74,44,"div",4),y.Vb(),y.Vb(),y.Vb(),y.Kc(42,$,11,9,"div",7),y.Vb()),2&e){var r=y.ic();y.Db(1),y.rc("ngIf",r.ygen.getSettings().checkoutordermsg&&r.ygen.getSettings().checkoutordermsg.length>0),y.Db(1),y.rc("ngIf",r.ygen.getSettings().stoporders||!r.ygen.isActiveSubscription()),y.Db(1),y.rc("linear",!1),y.Db(7),y.rc("ngIf",!(r.ygen.getSettings().onlystorepickup||r.ygen.getSettings().onlyhomepickup)),y.Db(1),y.rc("ngIf",r.ygen.getSettings().onlystorepickup||r.ygen.getSettings().onlyhomepickup),y.Db(3),y.Nc(y.kc(15,15,"Next")),y.Db(7),y.rc("formControl",r.paymentType),y.Db(1),y.rc("ngIf",r.ygen.getSettings().offercod),y.Db(1),y.rc("ngIf",r.ygen.getSettings().onlinepay),y.Db(3),y.Nc(y.kc(27,17,"Next")),y.Db(8),y.Nc(y.kc(35,19,"Delivery Note-Instruction")),y.Db(4),y.Nc(y.kc(39,21,"Leave a note-instruction about order")),y.Db(2),y.rc("formControl",r.deliveryNote),y.Db(1),y.rc("ngIf","HD"==r.deliveryType.value||r.isrequiredAddressForm()),y.Db(1),y.rc("ngIf",0==r.ycat.getcartcount())}}function ee(e,t){if(1&e&&(y.Wb(0,"ion-toolbar"),y.Wb(1,"div",54),y.Wb(2,"ion-text"),y.Wb(3,"h3"),y.Mc(4),y.jc(5,"translate"),y.Vb(),y.Vb(),y.Wb(6,"ion-text"),y.Wb(7,"h3"),y.Mc(8),y.Vb(),y.Vb(),y.Vb(),y.Vb()),2&e){var r=y.ic(2);y.Db(4),y.Nc(y.kc(5,3,"Delivery Charges")),y.Db(4),y.Pc(" ",r.ygen.getcurrencysymbol()," ",r.ygen.getSettings().deliverycharges," ")}}function te(e,t){if(1&e){var r=y.Xb();y.Wb(0,"ion-button",58),y.ec("click",(function(){y.Cc(r);var e=y.ic(3);return e.payoptions(e.ycat.getcart())})),y.Mc(1),y.jc(2,"translate"),y.Vb()}if(2&e){var n=y.ic(3);y.rc("disabled",n.isReady()),y.Db(1),y.Oc(" ",y.kc(2,2,"Complete Order"),"")}}function re(e,t){1&e&&(y.Wb(0,"ion-button",59),y.Mc(1),y.jc(2,"translate"),y.Vb()),2&e&&(y.Db(1),y.Oc(" ",y.kc(2,1,"No More Orders"),""))}function ne(e,t){if(1&e&&(y.Wb(0,"ion-toolbar",0),y.Wb(1,"div",55),y.Wb(2,"ion-text"),y.Wb(3,"h3"),y.Mc(4),y.jc(5,"translate"),y.Vb(),y.Vb(),y.Kc(6,te,3,4,"ion-button",56),y.Kc(7,re,3,3,"ion-button",57),y.Wb(8,"ion-text"),y.Wb(9,"h3"),y.Mc(10),y.Vb(),y.Vb(),y.Vb(),y.Vb()),2&e){var r=y.ic(2);y.rc("color","warning"),y.Db(4),y.Nc(y.kc(5,6,"Total")),y.Db(2),y.rc("ngIf",!r.ygen.getSettings().stoporders&&r.ygen.isActiveSubscription()&&!r.ispaypal),y.Db(1),y.rc("ngIf",r.ygen.getSettings().stoporders&&!r.ygen.isActiveSubscription()),y.Db(3),y.Pc(" ",r.ygen.getcurrencysymbol()," ",r.getTotal()," ")}}function ae(e,t){1&e&&y.Rb(0,"div",60,61)}function ie(e,t){if(1&e&&(y.Wb(0,"ion-footer"),y.Kc(1,ee,9,5,"ion-toolbar",4),y.Kc(2,ne,11,8,"ion-toolbar",52),y.Kc(3,ae,2,0,"div",53),y.Vb()),2&e){var r=y.ic();y.Db(1),y.rc("ngIf","HD"==r.deliveryType.value&&!r.ygen.getSettings().freedelivery&&r.ygen.getSettings().freedeliveryoveramount&&r.ygen.getSettings().freedeliveryamount>r.ycat.getTotal()||!r.ygen.getSettings().freedeliveryoveramount&&!r.ygen.getSettings().freedelivery),y.Db(1),y.rc("ngIf",r.ycat.getcartcount()>0),y.Db(1),y.rc("ngIf",r.ycat.getcartcount()>0&&r.ispaypal)}}var oe,se,ce=[{path:"",component:(oe=function(){function e(t,r,n,a,i,o,s,l,b,d,g,u,y,m,h,f,v){_classCallCheck(this,e),this.centerdb=t,this.http=r,this.ngxUiLoaderService=n,this.ynotification=a,this.yovalidation=i,this.yauth=o,this.ydata=s,this.router=l,this.ygen=b,this.events=d,this.ycat=g,this.alertme=u,this.spaypal=y,this.ystripe=m,this.ypaytm=h,this.ypay=f,this.dialog=v,this.serverpath=p.s.herobackendserver,this.ispaypal=!1,this.gotappsettings=new c.a(!1),this.ispaypal=this.ygen.getSettings().paypal}return _createClass(e,[{key:"buildForm",value:function(e){var t=this,r=e.country?e.country:"India",n=e.mobile?e.mobile:this.yauth.myprofile.mobile;this.addressForm=new a.h({userName:new a.e(e.userName,[a.y.required,a.y.minLength(2),a.y.maxLength(30)]),mobile:new a.e(n,[a.y.required,a.y.minLength(2),a.y.maxLength(30)]),unitName:new a.e(e.unitName,[a.y.required,a.y.minLength(2),a.y.maxLength(30)]),address:new a.e(e.address,[a.y.required,a.y.minLength(2),a.y.maxLength(100)]),city:new a.e(e.city,[a.y.required,a.y.minLength(2),a.y.maxLength(30)]),state:new a.e(e.state,[a.y.required,a.y.minLength(2),a.y.maxLength(30)]),zip:new a.e(e.zip,{validators:[a.y.required,a.y.minLength(2),a.y.maxLength(30)],asyncValidators:[Object(p.gb)(this.ygen)],updateOn:"blur"}),country:new a.e(r,{validators:[a.y.required,a.y.minLength(2),a.y.maxLength(30)]})});var i="HD";this.ygen.getSettings().onlystorepickup&&(i="SP"),this.ygen.getSettings().onlystorepickup||this.ygen.getSettings().onlyhomepickup||(i=""),this.deliveryType=new a.e(i,[a.y.required,a.y.max(2)]),setTimeout((function(){t.paymentType.setValue(i)}),100);var o="COD";this.ygen.getSettings().onlinepay&&(o="PNO"),this.ygen.getSettings().onlinepay||this.ygen.getSettings().offercod||(o=""),this.paymentType=new a.e(o,[a.y.required,a.y.max(3)]),setTimeout((function(){t.paymentType.setValue(o)}),100),this.deliveryNote=new a.e("Thanks",[a.y.required,a.y.max(100)]),this.addressForm.controls.mobile.setValue(n),this.addressForm.controls.country.setValue(r),this.ispaypal&&setTimeout((function(){t.payoptions(t.ycat.getcart())}),100)}},{key:"isrequiredAddressForm",value:function(){return!(!this.payer||this.payer.userName&&this.payer.mobile)}},{key:"ngOnInit",value:function(){var e=this;this.ydata.retrivedata(p.P.getpath()+"/settings",null).subscribe((function(t){e.yauth.setappSettings(t),e.gotappsettings.next(!0)})),this.ynotification.getStoreAdmins(),this.ygen.getUid()?this.getUserProfile().then((function(t){e.ngxUiLoaderService.stop(),e.payer=t,e.payer?e.buildForm(e.payer):(console.error("blank form"),e.buildForm({}))})).finally((function(){e.ngxUiLoaderService.stop()})):(this.yauth.setlanding("/checkoutdetail"),this.router.navigate(["/login"],{}))}},{key:"getUserProfile",value:function(){return Object(s.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ngxUiLoaderService.start(),e.next=3,this.ydata.getDatabase().object("/profiles/"+this.yauth.getCurrentUserId()).valueChanges().pipe(Object(b.a)(1)).toPromise();case 3:return t=e.sent,e.next=6,t;case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e,this)})))}},{key:"addtocart",value:function(e,t,r){r&&(t.orderqty=0);var n=t.orderqty?t.orderqty+e:1;n>t.maxqty?this.alertme.openSnackBar("Maximum quantiy you can order is ".concat(t.maxqty),"Ok"):(Object.assign(t,{orderqty:n}),this.ycat.iscartItem(t)?this.ycat.updatequantity(t):1==n&&(this.alertme.openSnackBar("Your shopping cart updated with ".concat(t.orderqty," quantity"),"Ok"),this.ycat.addtocart(t))),0==t.orderqty&&this.ycat.delete(t)}},{key:"pay",value:function(e){var t=this,r=""+ +new Date,n=this.ygen.randomletter()+this.ygen.randomletter()+~~(1e3*Math.random())+r.substring(r.length-4);e.forEach((function(e){e.$key?e.originalkey=e.$key:console.warn("no Key.."),delete e.$key}));var a={trancurrency:this.ygen.getTranCurrency().toLowerCase(),sendorderid:n,isorder:!0,payload:e,amount:this.getTotal(),orderByName:this.addressForm.controls.userName.value,orderByPhone:this.addressForm.controls.mobile.value,deliveryAddress:this.ygen.getAddress(this.addressForm.value),zipcode:this.addressForm.value.zip,city:this.addressForm.value.city,storeAddress:this.ygen.getAddress(p.db.selectedtenant),storePhone:this.ygen.getCommunityContactPhone(),storeId:this.ygen.getStoreKey(),wheredelivery:this.deliveryType.value,deliverynote:this.deliveryNote.value,storename:this.ygen.communityName(),orderedBy:this.payer.uid,islivetran:!this.ygen.getSettings().testonlinepay,gateway:"?"};"INVALID"!=this.addressForm.status&&this.ydata.getDatabase().object("/profiles/"+this.yauth.getCurrentUserId()).update(this.addressForm.value),this.ygen.getSettings().usepaytm?a.gateway="paytm":this.ygen.getSettings().userazorpay?a.gateway="razorpay":this.ygen.getSettings().usestripe?a.gateway="stripe":this.ygen.getSettings().paypal&&(a.gateway="paypal"),this.events.subscribe("order:success["+n+"]",(function(e){t.yauth.setlanding(null),t.events.unsubscribe("order:success["+n+"]"),t.ygen.findDistanceForOrder(a.deliveryAddress,!0);var r=t.ydata.getDatabase().createPushId();e.key=r,t.ydata.getDatabase().list(p.P.getpath()+"/shop/orders").set(r,e),t.ynotification.sendNotificationToTakeUser(t.payer.uid,{message:"Order Successfully placed with, OrderID=["+n+"]",path:"order?orderid="+r},"Order Success",!0,!0,!0),t.alertme.successdata("Order Successfully placed with, OrderID=["+n+"]").then((function(e){console.log("done",e)})),"razorpay"==a.gateway&&"COD"!=t.paymentType.value&&t.capturepayment(a),t.router.navigate(["/order"],{queryParams:{orderid:r,orderkey:n,orderplaced:!0}}),t.ycat.emptycart(),t.ycat.updateProductQuantity()})),"COD"==this.paymentType.value?(a.paymentmethod="COD",Object.assign(a,{orderedBy:this.payer.uid,odt:+new Date,ostatus:"NEW"}),this.events.publish("order:success["+a.sendorderid+"]",a)):this.ygen.getSettings().usepaytm?(a.gateway="paytm",this.ypaytm.pay(a)):this.ygen.getSettings().userazorpay?(a.gateway="razorpay",this.ypay.pay(a)):this.ygen.getSettings().paypal?(a.gateway="paypal",this.spaypal.setPayElement(this.paypalcontainer),this.spaypal.pay(a)):this.ygen.getSettings().usestripe?(a.gateway="stripe",this.gotappsettings.subscribe((function(e){e&&t.ystripe.pay(a)}))):this.alertme.errordata("No Payment Gateway Options enabled")}},{key:"onCountrySelected",value:function(e,t){t.setValue(e.name)}},{key:"payoptions",value:function(e){this.pay(e)}},{key:"getErrorMessage",value:function(e,t){var r="",n=this.getMeErrors({placeholder:t});return Object.keys(n).some((function(t){if(e.errors[t])return r=n[t],!0})),r}},{key:"getMeErrors",value:function(e){return this.yovalidation.genericErrors(e)}},{key:"getTotal",value:function(){var e=this.ycat.getTotal();return"HD"!=this.deliveryType.value||this.ygen.getSettings().freedelivery||(this.ygen.getSettings().freedeliveryoveramount&&this.ygen.getSettings().freedeliveryamount>this.ycat.getTotal()?e+=this.ygen.getSettings().deliverycharges:this.ygen.getSettings().freedeliveryoveramount||(e+=this.ygen.getSettings().deliverycharges)),e}},{key:"isReady",value:function(){var e=!0;return"HD"==this.deliveryType.value?e=!this.addressForm.valid:"SP"==this.deliveryType.value&&(e=this.isrequiredAddressForm()&&!this.addressForm.valid),e}},{key:"capturepayment",value:function(e){var t=this,r=e.key,n=this.yauth.getappSettings(),a=n.testonlinepay;n.testonlinepay||(a=!1);var i="".concat(p.s.herobackendserver,"/rest/razor/capture?testmode=").concat(a,"&paymentid=").concat(e.paymentResponse.payment_id),o={amount:100*e.amount,currency:"INR"},s={headers:new u.d({"Content-Type":"application/json",Authorization:"yoyo"})};this.http.post(i,o,s).pipe(Object(d.a)(1)).subscribe((function(e){var n={paymentcaptured:!0,paymentcaptureddetail:e};console.log("capture payment",e),e.err||t.ydata.getDatabase().list(p.P.getpath()+"/shop/orders").update(r,n)}),(function(e){t.ydata.getDatabase().list(p.P.getpath()+"/shop/orders").update(r,{paymentcaptured:!1,paymentcaptureddetail:{error:"Did not go well at server"}})}))}},{key:"createpickup",value:function(e){var t=this;if(this.ygen.getSettings().deliveryenabled){var r=+new Date,n={pickup_time:this.ygen.getTimeinformat(r,"HH:mm:ss"),pickup_date:this.ygen.getDateinformat(r,"YYYY-MM-DD"),pickup_location:this.ygen.getSettings().warehouse,expected_package_count:1},a={headers:new u.d({"Content-Type":"application/json",Authorization:"replacetoken"})},i="https://staging-express.delhivery.com/fm/request/new/";this.ygen.getSettings().testdelivery?a.headers=a.headers.set("Authorization","Token "+this.ygen.getSettings().deliverytokentest):(a.headers=a.headers.set("Authorization","Token "+this.ygen.getSettings().deliverytokenlive),i="https://track.delhivery.com/\u200bfm/request/new/"),this.http.post(i,n,a).pipe(Object(d.a)(3),Object(g.a)((function(e){return Object(l.a)(e)}))).subscribe((function(r){var n={deliverytrack:r,manualpickup:!1};t.orderlist.getListRefer().update(e,n),t.alertme.openSnackBar("Pick up request created [Auto]","Done")}),(function(r){t.orderlist.getListRefer().update(e,{manualpickup:!0}),t.alertme.openSnackBar("Pick up request created [Manual]","Ok")}))}}},{key:"onPopstate",value:function(){console.log("coming in"),this.ystripe.getHandler().close()}}]),e}(),oe.\u0275fac=function(e){return new(e||oe)(y.Qb(p.P),y.Qb(u.b),y.Qb(m.c),y.Qb(p.U),y.Qb(p.fb),y.Qb(p.M),y.Qb(p.Q),y.Qb(i.j),y.Qb(p.T),y.Qb(p.Y),y.Qb(p.O),y.Qb(p.a),y.Qb(p.ab),y.Qb(p.L),y.Qb(p.bb),y.Qb(p.Z),y.Qb(h.b))},oe.\u0275cmp=y.Kb({type:oe,selectors:[["app-checkoutdetail"]],viewQuery:function(e,t){var r;1&e&&y.Tc(C,!0),2&e&&y.yc(r=y.fc())&&(t.paypalcontainer=r.first)},hostBindings:function(e,t){1&e&&y.ec("popstate",(function(){return t.onPopstate()}),!1,y.Bc)},decls:9,vars:4,consts:[[3,"color"],["slot","start"],[2,"display","none",3,"src"],["class","ion-padding",4,"ngIf"],[4,"ngIf"],[1,"ion-padding"],["text-center","","class","msgTextSection",4,"ngIf"],["text-center","","class","cartTextSection",4,"ngIf"],[3,"linear"],["stepper",""],["matStepLabel",""],["class","example-radio-group","aria-label","Select an option",3,"formControl",4,"ngIf"],["color","warn","mat-button","","matStepperNext",""],["aria-label","Select an option",1,"example-radio-group",3,"formControl"],["class","example-radio-button","value","COD",4,"ngIf"],["class","example-radio-button","value","PNO",4,"ngIf"],[1,"example-form"],[1,"example-full-width"],["matInput","","placeholder","Ex. Thanks...",3,"formControl"],["text-center","",1,"msgTextSection"],[2,"right","20px","position","absolute"],[2,"display","inline-flex"],["style","padding-right: 5px;",4,"ngIf"],["mat-mini-fab","","style","background: lightgreen;",3,"click",4,"ngIf"],[2,"padding-right","5px"],[3,"mobile"],["mat-mini-fab","",2,"background","lightgreen",3,"click"],["name","logo-whatsapp",2,"font-size","x-large"],["text-center","",1,"cartTextSection"],["name","cart","role","img","aria-label","cart",1,"cartIcon"],["color","success","routerLink","/products"],["class","example-radio-button","value","HD",4,"ngIf"],["class","example-radio-button","value","SP",4,"ngIf"],["value","HD",1,"example-radio-button"],["value","SP",1,"example-radio-button"],["value","COD",1,"example-radio-button"],["value","PNO",1,"example-radio-button"],[1,"example-form",3,"formGroup"],["cellspacing","0",1,"example-full-width"],["yogagainv2InputUpper","","matInput","","formControlName","userName"],[3,"cssClass","preferredCountries","enablePlaceholder","placeholder","enableSearch","formControl","required"],["yogagainv2InputUpper","","matInput","","formControlName","unitName"],["matInput","","placeholder","Ex. CIVIL LINES","formControlName","address"],["matInput","","placeholder","Ex. GONDIA","formControlName","city"],["matInput","","placeholder","Ex. MAHARASHTRA","formControlName","state"],["type","number","matInput","","maxlength","5","placeholder","Ex. 94105","formControlName","zip"],["postalCode",""],["align","end"],[2,"display","none"],["matInput","","type","text","formControlName","country","required","true"],["whatcountry",""],[3,"country","onCountrySelected"],[3,"color",4,"ngIf"],["style","margin: 0 auto;display: flex;justify-content: center;padding-top: 10px;",4,"ngIf"],[1,"delivery"],[1,"footerCartSection"],["color","danger",3,"disabled","click",4,"ngIf"],["color","danger",4,"ngIf"],["color","danger",3,"disabled","click"],["color","danger"],[2,"margin","0 auto","display","flex","justify-content","center","padding-top","10px"],["paypalcontainer",""]],template:function(e,t){1&e&&(y.Wb(0,"ion-header"),y.Wb(1,"ion-toolbar",0),y.Wb(2,"ion-buttons",1),y.Rb(3,"ion-back-button"),y.Vb(),y.Wb(4,"ion-title"),y.Mc(5,"Payment/Delivery"),y.Vb(),y.Vb(),y.Vb(),y.Rb(6,"img",2),y.Kc(7,Z,43,23,"ion-content",3),y.Kc(8,ie,4,3,"ion-footer",4)),2&e&&(y.Db(1),y.rc("color","warning"),y.Db(5),y.tc("src","",t.serverpath,"/favicon.png",y.Ec),y.Db(1),y.rc("ngIf",t.payer),y.Db(1),y.rc("ngIf",t.payer&&t.ycat.getcartcount()>0))},directives:[o.y,o.hb,o.j,o.f,o.g,o.fb,n.m,o.s,f.e,f.a,f.b,v.a,f.d,k.b,a.p,a.f,a.A,a.q,a.r,D.c,D.g,V.b,a.c,p.j,o.z,o.i,o.sb,i.l,k.a,a.i,p.u,a.g,W.a,a.w,D.f,a.u,a.k,S.a,D.b,o.w,o.cb],pipes:[x.c],styles:[".footerCartSection[_ngcontent-%COMP%]{margin-right:10px;margin-left:10px}.delivery[_ngcontent-%COMP%], .footerCartSection[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.mat-form-field-infix[_ngcontent-%COMP%]{width:150px;max-width:150px}  .mat-form-field-infix{width:150px!important}.example-full-width[_ngcontent-%COMP%]{width:100%}td[_ngcontent-%COMP%]{padding-right:8px}.example-radio-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;margin:15px 0}.example-radio-button[_ngcontent-%COMP%]{margin:5px}.msgTextSection[_ngcontent-%COMP%]{display:flex;flex-direction:column}  .mat-vertical-content{padding:0!important}.example-form[_ngcontent-%COMP%]{padding:0}legend[_ngcontent-%COMP%]{font-size:small;line-height:inherit;color:#f44336}"]}),oe)}],le=((se=function e(){_classCallCheck(this,e)}).\u0275mod=y.Ob({type:se}),se.\u0275inj=y.Nb({factory:function(e){return new(e||se)},imports:[[n.c,a.j,o.ib,p.H,p.o,p.b,a.v,i.n.forChild(ce)]]}),se)}}]);