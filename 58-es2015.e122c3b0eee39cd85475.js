(window.webpackJsonp=window.webpackJsonp||[]).push([[58],{Fnjz:function(t,e,i){"use strict";i.r(e),i.d(e,"UploadcatalogPageModule",(function(){return W}));var a=i("ofXK"),s=i("3Pt+"),o=i("tyNb"),c=i("TEn/"),r=i("7pIB"),n=i("ybIa"),l=i("rIxz"),d=i("+DAS"),u=i("i2Ty"),p=i("MTSo"),h=i("DVUX"),g=i("fXoL"),b=i("P6Fj"),v=i("NFeN"),f=i("K88j");function m(t,e){if(1&t){const t=g.Xb();g.Wb(0,"div"),g.Wb(1,"input",7,8),g.ec("change",(function(e){return g.Cc(t),g.ic().previewFile(e)})),g.Vb(),g.Wb(3,"button",9),g.ec("click",(function(){return g.Cc(t),g.zc(2).click()})),g.Wb(4,"mat-icon",10),g.Lc(5,"extension"),g.Vb(),g.Lc(6," Add Products Catalog "),g.Vb(),g.Vb()}if(2&t){const t=g.ic();g.Db(1),g.rc("uploader",t.uploader)}}function y(t,e){if(1&t){const t=g.Xb();g.Wb(0,"div",11),g.Wb(1,"button",12),g.ec("click",(function(){return g.Cc(t),g.ic().clearAllItems()})),g.Wb(2,"mat-icon",10),g.Lc(3,"delete"),g.Vb(),g.Lc(4," Clear All Products "),g.Vb(),g.Wb(5,"button",9),g.ec("click",(function(){return g.Cc(t),g.ic().saveAllItems()})),g.Wb(6,"mat-icon",10),g.Lc(7,"save"),g.Vb(),g.Lc(8," Save All Products "),g.Vb(),g.Vb()}}function k(t,e){if(1&t){const t=g.Xb();g.Wb(0,"app-productcard",13),g.ec("actionevent",(function(e){return g.Cc(t),g.ic().perform(e)})),g.Vb()}if(2&t){const t=e.$implicit,i=g.ic();g.rc("product",t)("productlist",i.crudList)("onpage","uploadcatalog")("catalogupload",!0)}}let w=(()=>{class t{constructor(t,e,i,a,s,o){this.toast=t,this.ydata=e,this.ygen=i,this.papa=a,this.yalert=s,this.photoUploadService=o,this.clearme=!0,this.productlimit=50,this.products=[],this.crudList=new n.a("/shop/products",e.getDatabase(),!0,this.ygen.getUid()),this.uploader=o.getUploader(),o.getUploader().clearQueue(),o.getUploader().cancelAll()}ngOnInit(){this.crudList.getList().subscribe(t=>{this.productlimit=t.length})}previewFile(t){t.srcElement&&t.srcElement.files&&t.srcElement.files[0]&&(t.srcElement.files[0].name.includes(".csv")?(this.toast.pop("success","Got the event & processing "+t.target.files.length+" file","Ok"),this.toast.pop("warn","Reading files","Processing"),this.papa.parse(t.srcElement.files[0],{complete:(t,e)=>{t.errors.forEach(e=>t.data.splice(e.row,1)),t.data.forEach(t=>{if(t.outofstock=!1,t.soldout=!1,t.isorganic=this.giveflag(t.isorganic),t.istopsaver=this.giveflag(t.istopsaver),t.heavydiscount=this.giveflag(t.heavydiscount),t.newarrival=this.giveflag(t.newarrival),t.isveg=this.giveflag(t.isveg),t.uploaded=this.giveflag(t.uploaded),t.discount=this.getDiscount(t),t.variations){let i=t.variations.replace(/\|/g,",");try{let e=JSON.parse(i),a={},s=0;e.forEach(t=>{a[s]=t,s++}),s>0&&(t.variations=a)}catch(e){t.variations=null}}}),this.products=t.data.filter(t=>!t.uploaded)},delimiter:",",header:!0})):this.yalert.errordata("Only CSV files are allowed"))}giveflag(t){return!!t&&"TRUE"==t}getDiscount(t){let e=t.mrp;return(100*(e-t.price)/e).toFixed(0)}savewithVariation(t){let e=this.ydata.getDatabase().createPushId();delete t.$key;let i=t.variations;delete t.variations,t.discount=this.getDiscount(t),this.crudList.getListRefer().set(e,t),Object.values(i).forEach(t=>{this.ydata.getDatabase().list("/shop/products/"+e+"/variations").push(t)})}saveAllItems(){this.yalert.openSnackBar("Saving All Products at once","Ok"),this.products.forEach(t=>{delete t.$key,t.discount=this.getDiscount(t),this.ygen.canAddProducts()?t.variations?this.savewithVariation(t):this.crudList.addtolist(t):console.log("Products will not be added")}),this.clearAllItems()}saveItem(t){t.discount=this.getDiscount(t),t.variations?this.savewithVariation(t):this.crudList.addtolist(t)}perform(t){switch(console.log(t),t.what){case"add":t.event.discount=this.getDiscount(t.event),this.saveItem(t.event),this.products=this.products.filter(e=>e.$key!=t.event.$key),this.yalert.openSnackBar("Product saved","Ok");break;case"delete":this.products=this.products.filter(e=>e.$key!=t.event.$key),this.yalert.openSnackBar("Product deleted","Ok");break;case"copy":t.event.discount=this.getDiscount(t.event),this.products.push(t.event),this.yalert.openSnackBar("Product copied","Ok")}}clearAllItems(){this.products.length=0,this.clearme=!1,setTimeout(()=>{this.clearme=!0},500)}}return t.\u0275fac=function(e){return new(e||t)(g.Qb(h.d),g.Qb(d.a),g.Qb(l.a),g.Qb(b.a),g.Qb(u.a),g.Qb(p.a))},t.\u0275cmp=g.Kb({type:t,selectors:[["app-uploadcatalog"]],decls:13,vars:6,consts:[[3,"color"],["slot","start"],["padding",""],[4,"ngIf"],["style","padding:5px",4,"ngIf"],[1,"productlist"],[3,"product","productlist","onpage","catalogupload","actionevent",4,"ngFor","ngForOf"],["hidden","","type","file","ng2FileSelect","",3,"uploader","change"],["productsFileInput",""],[1,"mat-raised-button","mat-primary",3,"click"],["color","warm",1,"pointer"],[2,"padding","5px"],[1,"mat-raised-button","mat-secondary",3,"click"],[3,"product","productlist","onpage","catalogupload","actionevent"]],template:function(t,e){1&t&&(g.Wb(0,"ion-header"),g.Wb(1,"ion-toolbar",0),g.Wb(2,"ion-buttons",1),g.Rb(3,"ion-back-button"),g.Vb(),g.Wb(4,"ion-title"),g.Lc(5,"Upload Product Catalog"),g.Vb(),g.Vb(),g.Vb(),g.Wb(6,"ion-content",2),g.Jc(7,m,7,1,"div",3),g.Jc(8,y,9,0,"div",4),g.Wb(9,"ion-item"),g.Lc(10),g.Vb(),g.Wb(11,"div",5),g.Jc(12,k,1,4,"app-productcard",6),g.Vb(),g.Vb()),2&t&&(g.Db(1),g.rc("color","warning"),g.Db(6),g.rc("ngIf",e.clearme),g.Db(1),g.rc("ngIf",e.products.length>0),g.Db(2),g.Oc(' You are using "',e.ygen.getSubscriptionType(),'" subscription; You can add max ',e.ygen.maxproductsCanAdded()," products; "),g.Db(2),g.rc("ngForOf",e.products))},directives:[c.v,c.ab,c.j,c.f,c.g,c.Y,c.s,a.m,c.y,a.l,r.a,v.a,f.a],styles:[".productlist[_ngcontent-%COMP%]{display:flex;flex-direction:row;flex-wrap:wrap;align-items:stretch}"]}),t})();var V=i("hVaU"),D=i("IZvt"),I=i("4pxM");const L=[{path:"",component:w}];let W=(()=>{class t{}return t.\u0275mod=g.Ob({type:t}),t.\u0275inj=g.Nb({factory:function(e){return new(e||t)},imports:[[a.c,s.i,c.bb,V.a,D.a,I.a,r.b,o.k.forChild(L)]]}),t})()}}]);