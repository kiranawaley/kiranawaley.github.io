function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var a=0;a<e.length;a++){var i=e[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function _createClass(t,e,a){return e&&_defineProperties(t.prototype,e),a&&_defineProperties(t,a),t}(window.webpackJsonp=window.webpackJsonp||[]).push([[58],{Fnjz:function(t,e,a){"use strict";a.r(e),a.d(e,"UploadcatalogPageModule",(function(){return W}));var i=a("ofXK"),n=a("3Pt+"),o=a("tyNb"),c=a("TEn/"),r=a("7pIB"),s=a("ybIa"),l=a("rIxz"),u=a("+DAS"),d=a("i2Ty"),p=a("MTSo"),f=a("DVUX"),v=a("fXoL"),b=a("P6Fj"),g=a("NFeN"),h=a("K88j");function y(t,e){if(1&t){var a=v.Xb();v.Wb(0,"div"),v.Wb(1,"input",7,8),v.ec("change",(function(t){return v.Cc(a),v.ic().previewFile(t)})),v.Vb(),v.Wb(3,"button",9),v.ec("click",(function(){return v.Cc(a),v.zc(2).click()})),v.Wb(4,"mat-icon",10),v.Lc(5,"extension"),v.Vb(),v.Lc(6," Add Products Catalog "),v.Vb(),v.Vb()}if(2&t){var i=v.ic();v.Db(1),v.rc("uploader",i.uploader)}}function m(t,e){if(1&t){var a=v.Xb();v.Wb(0,"div",11),v.Wb(1,"button",12),v.ec("click",(function(){return v.Cc(a),v.ic().clearAllItems()})),v.Wb(2,"mat-icon",10),v.Lc(3,"delete"),v.Vb(),v.Lc(4," Clear All Products "),v.Vb(),v.Wb(5,"button",9),v.ec("click",(function(){return v.Cc(a),v.ic().saveAllItems()})),v.Wb(6,"mat-icon",10),v.Lc(7,"save"),v.Vb(),v.Lc(8," Save All Products "),v.Vb(),v.Vb()}}function k(t,e){if(1&t){var a=v.Xb();v.Wb(0,"app-productcard",13),v.ec("actionevent",(function(t){return v.Cc(a),v.ic().perform(t)})),v.Vb()}if(2&t){var i=e.$implicit,n=v.ic();v.rc("product",i)("productlist",n.crudList)("onpage","uploadcatalog")("catalogupload",!0)}}var w,V,C=((w=function(){function t(e,a,i,n,o,c){_classCallCheck(this,t),this.toast=e,this.ydata=a,this.ygen=i,this.papa=n,this.yalert=o,this.photoUploadService=c,this.clearme=!0,this.productlimit=50,this.products=[],this.crudList=new s.a("/shop/products",a.getDatabase(),!0,this.ygen.getUid()),this.uploader=c.getUploader(),c.getUploader().clearQueue(),c.getUploader().cancelAll()}return _createClass(t,[{key:"ngOnInit",value:function(){var t=this;this.crudList.getList().subscribe((function(e){t.productlimit=e.length}))}},{key:"previewFile",value:function(t){var e=this;this.toast.pop("success","Got the event & processing "+t.target.files.length+" file","Ok"),t.srcElement&&t.srcElement.files&&t.srcElement.files[0]&&(t.srcElement.files[0].name.includes(".csv")?(this.toast.pop("warn","Reading files","Processing"),this.papa.parse(t.srcElement.files[0],{complete:function(t,a){t.errors.forEach((function(e){return t.data.splice(e.row,1)})),t.data.forEach((function(t){if(t.outofstock=!1,t.soldout=!1,t.isorganic=e.giveflag(t.isorganic),t.istopsaver=e.giveflag(t.istopsaver),t.heavydiscount=e.giveflag(t.heavydiscount),t.newarrival=e.giveflag(t.newarrival),t.isveg=e.giveflag(t.isveg),t.uploaded=e.giveflag(t.uploaded),t.discount=e.getDiscount(t),t.variations){var a=t.variations.replace(/\|/g,",");try{var i=JSON.parse(a),n={},o=0;i.forEach((function(t){n[o]=t,o++})),o>0&&(t.variations=n)}catch(c){t.variations=null}}})),e.products=t.data.filter((function(t){return!t.uploaded}))},delimiter:",",header:!0})):this.yalert.errordata("Only CSV files are allowed"))}},{key:"giveflag",value:function(t){return!!t&&"TRUE"==t}},{key:"getDiscount",value:function(t){var e=t.mrp;return(100*(e-t.price)/e).toFixed(0)}},{key:"savewithVariation",value:function(t){var e=this,a=this.ydata.getDatabase().createPushId();delete t.$key;var i=t.variations;delete t.variations,t.discount=this.getDiscount(t),this.crudList.getListRefer().set(a,t),Object.values(i).forEach((function(t){e.ydata.getDatabase().list("/shop/products/"+a+"/variations").push(t)}))}},{key:"saveAllItems",value:function(){var t=this;this.yalert.openSnackBar("Saving All Products at once","Ok"),this.products.forEach((function(e){delete e.$key,e.discount=t.getDiscount(e),t.ygen.canAddProducts()?e.variations?t.savewithVariation(e):t.crudList.addtolist(e):console.log("Products will not be added")})),this.clearAllItems()}},{key:"saveItem",value:function(t){t.discount=this.getDiscount(t),t.variations?this.savewithVariation(t):this.crudList.addtolist(t)}},{key:"perform",value:function(t){switch(console.log(t),t.what){case"add":t.event.discount=this.getDiscount(t.event),this.saveItem(t.event),this.products=this.products.filter((function(e){return e.$key!=t.event.$key})),this.yalert.openSnackBar("Product saved","Ok");break;case"delete":this.products=this.products.filter((function(e){return e.$key!=t.event.$key})),this.yalert.openSnackBar("Product deleted","Ok");break;case"copy":t.event.discount=this.getDiscount(t.event),this.products.push(t.event),this.yalert.openSnackBar("Product copied","Ok")}}},{key:"clearAllItems",value:function(){var t=this;this.products.length=0,this.clearme=!1,setTimeout((function(){t.clearme=!0}),500)}}]),t}()).\u0275fac=function(t){return new(t||w)(v.Qb(f.d),v.Qb(u.a),v.Qb(l.a),v.Qb(b.a),v.Qb(d.a),v.Qb(p.a))},w.\u0275cmp=v.Kb({type:w,selectors:[["app-uploadcatalog"]],decls:13,vars:6,consts:[[3,"color"],["slot","start"],["padding",""],[4,"ngIf"],["style","padding:5px",4,"ngIf"],[1,"productlist"],[3,"product","productlist","onpage","catalogupload","actionevent",4,"ngFor","ngForOf"],["hidden","","type","file","ng2FileSelect","",3,"uploader","change"],["productsFileInput",""],[1,"mat-raised-button","mat-primary",3,"click"],["color","warm",1,"pointer"],[2,"padding","5px"],[1,"mat-raised-button","mat-secondary",3,"click"],[3,"product","productlist","onpage","catalogupload","actionevent"]],template:function(t,e){1&t&&(v.Wb(0,"ion-header"),v.Wb(1,"ion-toolbar",0),v.Wb(2,"ion-buttons",1),v.Rb(3,"ion-back-button"),v.Vb(),v.Wb(4,"ion-title"),v.Lc(5,"Upload Product Catalog"),v.Vb(),v.Vb(),v.Vb(),v.Wb(6,"ion-content",2),v.Jc(7,y,7,1,"div",3),v.Jc(8,m,9,0,"div",4),v.Wb(9,"ion-item"),v.Lc(10),v.Vb(),v.Wb(11,"div",5),v.Jc(12,k,1,4,"app-productcard",6),v.Vb(),v.Vb()),2&t&&(v.Db(1),v.rc("color","warning"),v.Db(6),v.rc("ngIf",e.clearme),v.Db(1),v.rc("ngIf",e.products.length>0),v.Db(2),v.Oc(' You are using "',e.ygen.getSubscriptionType(),'" subscription; You can add max ',e.ygen.maxproductsCanAdded()," products; "),v.Db(2),v.rc("ngForOf",e.products))},directives:[c.v,c.ab,c.j,c.f,c.g,c.Y,c.s,i.m,c.y,i.l,r.a,g.a,h.a],styles:[".productlist[_ngcontent-%COMP%]{display:flex;flex-direction:row;flex-wrap:wrap;align-items:stretch}"]}),w),P=a("hVaU"),D=a("IZvt"),I=a("4pxM"),L=[{path:"",component:C}],W=((V=function t(){_classCallCheck(this,t)}).\u0275mod=v.Ob({type:V}),V.\u0275inj=v.Nb({factory:function(t){return new(t||V)},imports:[[i.c,n.i,c.bb,P.a,D.a,I.a,r.b,o.k.forChild(L)]]}),V)}}]);